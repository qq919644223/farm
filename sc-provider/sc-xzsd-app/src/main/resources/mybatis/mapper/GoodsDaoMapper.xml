<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.xzsd.app.goods.dao.GoodsDao">
    <!--产品评价信息集合-->
    <resultMap id="GoodsEvaluatesMap" type="com.xzsd.app.goods.entity.GoodsEvaluates">
        <id column="appraise_code" property="appraiseCode" jdbcType="VARCHAR" />
        <result column="user_code" property="userCode" jdbcType="VARCHAR" />
        <result column="user_acct" property="userAcct" jdbcType="VARCHAR" />
        <result column="appraise_detail" property="appraiseDetai" jdbcType="VARCHAR" />
        <result column="a_level" property="appraiseLevel" jdbcType="VARCHAR"/>
        <result column="goods_code" property="goodsCode" jdbcType="VARCHAR"/>
        <result column="create_time" property="createTime" jdbcType="VARCHAR"/>
    </resultMap>
    <!--获取商品信息-->
    <select id="getGoods" parameterType="java.lang.String" resultType="com.xzsd.app.goods.entity.GoodsInfo">
       select
         a.goods_code goodsCode,
         a.goods_name goodsName,
         b.store_code storeCode,
         b.store_name storeName,
         a.goods_introduce goodsIntroduce,
         a.sale_price salePrice,
         a.image_path imagePath,
         a.a_level appraiseLeve,
         a.sum_sale orderSum,
         a.version version
       from
         t_goods a
       LEFT JOIN
       on a.store_code = b.store_code
       where
         a.goods_code = #{goodsCode}
       and
         a.is_deleted = 0
    </select>

    <!--查询产品评价列表-->
    <select id="listGoodsEvaluatesByPage" parameterType="com.xzsd.app.goods.entity.GoodsEvaluates" resultMap="GoodsEvaluatesMap">
        select
        b.user_acct,
        a.appraise_detail,
        a.a_level,
        a.create_time,
        a.user_code
        from
        t_goods_appraise a,t_sys_user b
        where
        a.user_code = b.user_code
        and
        a.is_deleted = 0
        and
        a.goods_code = #{goodsCode}
        <if test="appraiseLevel == 1">
            and (a.a_level = 0 or a.a_level = 1)
        </if>
        <if test="appraiseLevel == 3">
            and (a.a_level = 2 or a.a_level = 3)
        </if>
        <if test="appraiseLevel == 5">
            and (a.a_level = 4 or a.a_level = 5)
        </if>
    </select>

    <!--查询商品一级分类列表-->
    <select id="getFirstClass" parameterType="com.xzsd.app.goods.entity.GoodsClassInfo" resultType="com.xzsd.app.goods.entity.GoodsClassInfo">
        select
            a.class_name classFirstName,
            a.class_code classFirstCode,
            a.version version
        from t_goods_class a
        where a.is_deleted = 0
        and a.last_class_code is null
        order by create_time desc
    </select>

    <!--二级分类商品的Map-->
    <resultMap id="getSecondClass" type="com.xzsd.app.goods.entity.GoodsClassInfo">
        <id column="class_code" property="classSecondCode" jdbcType="VARCHAR" />
        <id column="class_name" property="classSecondName" jdbcType="VARCHAR" />
        <collection property="classSecondGoodsList" ofType="com.xzsd.app.goods.entity.ClassSecondList" select="selectGoods" column="class_code">
            <id column="goods_code" property="goodsCode" jdbcType="VARCHAR" />
            <id column="goods_name" property="goodsName" jdbcType="VARCHAR" />
            <id column="image_url" property="imageUrl" jdbcType="VARCHAR" />
            <id column="sale_price" property="salePrice" jdbcType="VARCHAR" />
        </collection>
    </resultMap>
    <!--查询商品二级分类和商品-->
    <select id="getSecondClass" resultMap="getSecondClass">
        select
            class_name,
            class_code
        from t_goods_class
        where is_deleted = 0
        and last_class_code = #{lastClassCode}
        order by
        create_time desc
    </select>
    <select id="selectGoods" parameterType="com.xzsd.app.goods.entity.GoodsClassInfo" resultType="com.xzsd.app.goods.entity.GoodsClassInfo">
        select
            goods_code goodsCode,
            goods_name goodsName,
            image_url imageUrl,
            sale_price salePrice
        from t_goods
        where class_second_code = #{classSecondCode}
        and is_deleted = 0
        and goods_state = 2
        order by
        create_time desc
    </select>

</mapper>